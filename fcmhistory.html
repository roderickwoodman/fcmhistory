<!DOCTYPE html>
<html>

<head>

</head>

<body onload="init()">
    <h1>Hello World!</h1>
    <form onsubmit="onUpload()">
        <input id="file-input" type="file" />
        <button type="submit">Upload</button>
    </form>

    <script>
        let file;

        function init() {
            let input = document.getElementById('file-input');
            input.onchange = e => {
                file = e.target.files[0];
            }
        }

        function onUpload() {
            event.preventDefault()

            let reader = new FileReader();
            reader.readAsText(file, 'UTF-8');
            reader.onload = readerEvent => {
                let content = readerEvent.target.result;
                parseContent(content);
            }
        }

        function parseContent(content) {
            var lines = content.split(/[\r\n]+/g);
            const timestamp_regex = /^[0-9]{4}[\/][0-9]{2}[\/][0-9]{2}/g;
            const turns_regex = /Start of turn/g;
            const restaurant_regex = /restaurant/g;
            const uses_regex = /uses his\/her team :/g;
            const plays_regex = /(chooses to play|has to play)/g;
            const trains_regex = /trains :/g;
            const hires_regex = /hires :/g;
            const fires_regex = /fires/g;
            let messages = [];
            let last_message = {
                body: []
            };
            let turns = [];
            let restaurant = [];
            let uses = [];
            let plays = [];
            let trains = [];
            let hires = [];
            let fires = [];
            let other = [];
            lines.forEach(function(line, idx) {
                if (timestamp_regex.test(line)) {
                    messages.push(last_message);
                    last_message = {
                        timestamp: line,
                        body: []
                    }
                } else {
                    last_message['body'].push(line);
                    if (turns_regex.test(line)) {
                        turns.push(line);
                    } else if (restaurant_regex.test(line)) {
                        restaurant.push(line);
                    } else if (uses_regex.test(line)) {
                        uses.push(line);
                    } else if (plays_regex.test(line)) {
                        plays.push(line);
                    } else if (trains_regex.test(line)) {
                        trains.push(line);
                    } else if (hires_regex.test(line)) {
                        hires.push(line);
                    } else if (fires_regex.test(line)) {
                        fires.push(line);
                    } else {
                        other.push(line);
                    }
                }
            })
            // console.log('ALL MESSAGES:', messages);
            console.log('LINES=' + lines.length + ' MESSAGES=' + messages.length);
            // console.log('turns:',turns);
            // console.log('restaurant:',restaurant);
            // console.log('uses:',uses);
            // console.log('plays:',plays);
            // console.log('trains:',trains);
            // console.log('hires:',hires);
            // console.log('fires:',fires);
            console.log('other:',other);
        }

    </script>
</body>

</html>