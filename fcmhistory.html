<!DOCTYPE html>
<html>

<head>

</head>

<body onload="init()">
    <h1>Hello World!</h1>
    <form onsubmit="onUpload()">
        <input id="file-input" type="file" />
        <button type="submit">Upload</button>
    </form>

    <script>
        let file;

        function init() {
            let input = document.getElementById('file-input');
            input.onchange = e => {
                file = e.target.files[0];
            }
        }

        function onUpload() {
            event.preventDefault()

            let reader = new FileReader();
            reader.readAsText(file, 'UTF-8');
            reader.onload = readerEvent => {
                let content = readerEvent.target.result;
                parseContent(content);
            }
        }

        function parseContent(content) {
            var lines = content.split(/[\r\n]+/g);
            const timestamp_regex = /^[0-9]{4}[\/][0-9]{2}[\/][0-9]{2}/g;
            let messages = [];
            let last_message = {
                body: []
            };
            lines.forEach(function(line, idx) {
                let is_timestamp = timestamp_regex.test(line)
                if (is_timestamp) {
                    messages.push(last_message);
                    last_message = {
                        timestamp: line,
                        body: []
                    }
                } else {
                    last_message['body'].push(line);
                }
            })
            console.log('ALL MESSAGES:', messages)
            console.log('LINES=' + lines.length + ' MESSAGES=' + messages.length)
        }

    </script>
</body>

</html>